# generated by datamodel-codegen:
#   filename:  sync-creatives-response.json
#   timestamp: 2025-11-15T17:41:22+00:00

from __future__ import annotations

from enum import Enum
from typing import Any

from adcp.types.base import AdCPBaseModel
from pydantic import AnyUrl, AwareDatetime, ConfigDict, Field, RootModel


class Action(Enum):
    created = 'created'
    updated = 'updated'
    unchanged = 'unchanged'
    failed = 'failed'
    deleted = 'deleted'


class Creative(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    creative_id: str = Field(..., description='Creative ID from the request')
    action: Action = Field(..., description='Action taken for this creative')
    platform_id: str | None = Field(
        None, description='Platform-specific ID assigned to the creative'
    )
    changes: list[str] | None = Field(
        None, description="Field names that were modified (only present when action='updated')"
    )
    errors: list[str] | None = Field(
        None, description="Validation or processing errors (only present when action='failed')"
    )
    warnings: list[str] | None = Field(None, description='Non-fatal warnings about this creative')
    preview_url: AnyUrl | None = Field(
        None,
        description='Preview URL for generative creatives (only present for generative formats)',
    )
    expires_at: AwareDatetime | None = Field(
        None,
        description='ISO 8601 timestamp when preview link expires (only present when preview_url exists)',
    )
    assigned_to: list[str] | None = Field(
        None,
        description='Package IDs this creative was successfully assigned to (only present when assignments were requested)',
    )
    assignment_errors: dict[str, str] | None = Field(
        None,
        description='Assignment errors by package ID (only present when assignment failures occurred)',
    )


class SyncCreativesResponse1(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    dry_run: bool | None = Field(
        None, description='Whether this was a dry run (no actual changes made)'
    )
    creatives: list[Creative] = Field(
        ...,
        description="Results for each creative processed. Items with action='failed' indicate per-item validation/processing failures, not operation-level failures.",
    )
    context: dict[str, Any] | None = Field(
        None,
        description='Initiator-provided context echoed inside the task payload. Opaque metadata such as UI/session hints, correlation tokens, or tracking identifiers.',
    )


class Error(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    code: str = Field(..., description='Error code for programmatic handling')
    message: str = Field(..., description='Human-readable error message')
    field: str | None = Field(
        None, description="Field path associated with the error (e.g., 'packages[0].targeting')"
    )
    suggestion: str | None = Field(None, description='Suggested fix for the error')
    retry_after: float | None = Field(
        None, description='Seconds to wait before retrying the operation', ge=0.0
    )
    details: Any | None = Field(None, description='Additional task-specific error details')


class SyncCreativesResponse2(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    errors: list[Error] = Field(
        ...,
        description='Operation-level errors that prevented processing any creatives (e.g., authentication failure, service unavailable, invalid request format)',
        min_length=1,
    )
    context: dict[str, Any] | None = Field(
        None,
        description='Initiator-provided context echoed inside the task payload. Opaque metadata such as UI/session hints, correlation tokens, or tracking identifiers.',
    )


class SyncCreativesResponse(RootModel[SyncCreativesResponse1 | SyncCreativesResponse2]):
    root: SyncCreativesResponse1 | SyncCreativesResponse2 = Field(
        ...,
        description='Response from creative sync operation. Returns either per-creative results (best-effort processing) OR operation-level errors (complete failure). This enforces atomic semantics at the operation level while allowing per-item failures within successful operations.',
        title='Sync Creatives Response',
    )

# Aliases for backward compatibility
SyncCreativesSuccess = SyncCreativesResponse1
SyncCreativesError = SyncCreativesResponse2
