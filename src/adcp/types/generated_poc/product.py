# generated by datamodel-codegen:
#   filename:  product.json
#   timestamp: 2025-11-15T17:41:05+00:00

from __future__ import annotations

from enum import Enum
from typing import Any, Literal

from adcp.types.base import AdCPBaseModel
from pydantic import AnyUrl, AwareDatetime, ConfigDict, Field, RootModel


class PropertyId(RootModel[str]):
    root: str = Field(..., pattern='^[a-z0-9_]+$')


class PropertyTag(RootModel[str]):
    root: str = Field(..., pattern='^[a-z0-9_]+$')


class PublisherProperty(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    publisher_domain: str = Field(
        ...,
        description="Domain where publisher's adagents.json is hosted (e.g., 'cnn.com')",
        pattern='^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$',
    )
    property_ids: list[PropertyId] | None = Field(
        None,
        description="Specific property IDs from the publisher's adagents.json. Mutually exclusive with property_tags.",
        min_length=1,
    )
    property_tags: list[PropertyTag] | None = Field(
        None,
        description="Property tags from the publisher's adagents.json. Product covers all properties with these tags. Mutually exclusive with property_ids.",
        min_length=1,
    )


class DeliveryMeasurement(AdCPBaseModel):
    provider: str = Field(
        ...,
        description="Measurement provider(s) used for this product (e.g., 'Google Ad Manager with IAS viewability', 'Nielsen DAR', 'Geopath for DOOH impressions')",
    )
    notes: str | None = Field(
        None,
        description="Additional details about measurement methodology in plain language (e.g., 'MRC-accredited viewability. 50% in-view for 1s display / 2s video', 'Panel-based demographic measurement updated monthly')",
    )


class FormatId(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    agent_url: AnyUrl = Field(
        ...,
        description="URL of the agent that defines this format (e.g., 'https://creatives.adcontextprotocol.org' for standard formats, or 'https://publisher.com/.well-known/adcp/sales' for custom formats)",
    )
    id: str = Field(
        ...,
        description="Format identifier within the agent's namespace (e.g., 'display_300x250', 'video_standard_30s')",
        pattern='^[a-zA-Z0-9_-]+$',
    )


class Placement(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    placement_id: str = Field(
        ..., description='Unique identifier for the placement within the product'
    )
    name: str = Field(
        ...,
        description="Human-readable name for the placement (e.g., 'Homepage Banner', 'Article Sidebar')",
    )
    description: str | None = Field(
        None, description='Detailed description of where and how the placement appears'
    )
    format_ids: list[FormatId] | None = Field(
        None,
        description="Format IDs supported by this specific placement (subset of product's formats)",
        min_length=1,
    )


class DeliveryType(Enum):
    guaranteed = 'guaranteed'
    non_guaranteed = 'non_guaranteed'


class CpmFixedOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'cpm_usd_guaranteed')",
    )
    pricing_model: Literal['cpm'] = Field(..., description='Cost per 1,000 impressions')
    rate: float = Field(..., description='Fixed CPM rate (cost per 1,000 impressions)', ge=0.0)
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class PriceGuidance(AdCPBaseModel):
    floor: float = Field(
        ..., description='Minimum bid price - publisher will reject bids under this value', ge=0.0
    )
    p25: float | None = Field(None, description='25th percentile winning price', ge=0.0)
    p50: float | None = Field(None, description='Median winning price', ge=0.0)
    p75: float | None = Field(None, description='75th percentile winning price', ge=0.0)
    p90: float | None = Field(None, description='90th percentile winning price', ge=0.0)


class CpmAuctionOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'cpm_usd_auction')",
    )
    pricing_model: Literal['cpm'] = Field(..., description='Cost per 1,000 impressions')
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    price_guidance: PriceGuidance = Field(
        ..., description='Pricing guidance for auction-based CPM bidding'
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class VcpmFixedOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'vcpm_usd_guaranteed')",
    )
    pricing_model: Literal['vcpm'] = Field(
        ..., description='Cost per 1,000 viewable impressions (MRC standard)'
    )
    rate: float = Field(
        ..., description='Fixed vCPM rate (cost per 1,000 viewable impressions)', ge=0.0
    )
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class PriceGuidance1(AdCPBaseModel):
    floor: float = Field(..., description='Minimum acceptable bid price', ge=0.0)
    p25: float | None = Field(None, description='25th percentile of recent winning bids', ge=0.0)
    p50: float | None = Field(None, description='Median of recent winning bids', ge=0.0)
    p75: float | None = Field(None, description='75th percentile of recent winning bids', ge=0.0)
    p90: float | None = Field(None, description='90th percentile of recent winning bids', ge=0.0)


class VcpmAuctionOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'vcpm_usd_auction')",
    )
    pricing_model: Literal['vcpm'] = Field(
        ..., description='Cost per 1,000 viewable impressions (MRC standard)'
    )
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    price_guidance: PriceGuidance1 = Field(
        ..., description='Statistical guidance for auction pricing'
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class CpcOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'cpc_usd_fixed')",
    )
    pricing_model: Literal['cpc'] = Field(..., description='Cost per click')
    rate: float = Field(..., description='Fixed CPC rate (cost per click)', ge=0.0)
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class CpcvOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'cpcv_usd_guaranteed')",
    )
    pricing_model: Literal['cpcv'] = Field(
        ..., description='Cost per completed view (100% completion)'
    )
    rate: float = Field(..., description='Fixed CPCV rate (cost per 100% completion)', ge=0.0)
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class ViewThreshold(RootModel[float]):
    root: float = Field(
        ...,
        description='Percentage completion threshold for CPV pricing (0.0 to 1.0, e.g., 0.5 = 50% completion)',
        ge=0.0,
        le=1.0,
    )


class ViewThreshold1(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    duration_seconds: int = Field(
        ...,
        description="Seconds of viewing required (e.g., 30 for YouTube-style '30 seconds = view')",
        ge=1,
    )


class Parameters(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    view_threshold: ViewThreshold | ViewThreshold1


class CpvOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'cpv_usd_50pct')",
    )
    pricing_model: Literal['cpv'] = Field(..., description='Cost per view at threshold')
    rate: float = Field(..., description='Fixed CPV rate (cost per view)', ge=0.0)
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    parameters: Parameters = Field(
        ..., description='CPV-specific parameters defining the view threshold'
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class Parameters1(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    demographic: str = Field(
        ...,
        description='Target demographic in Nielsen format: P/M/W/A/C + age range. Examples: P18-49 (Persons 18-49), M25-54 (Men 25-54), W35+ (Women 35+), A18-34 (Adults 18-34), C2-11 (Children 2-11)',
        pattern='^[PMWAC][0-9]{2}(-[0-9]{2}|\\+)$',
    )
    min_points: float | None = Field(
        None, description='Minimum GRPs/TRPs required for this pricing option', ge=0.0
    )


class CppOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'cpp_usd_p18-49')",
    )
    pricing_model: Literal['cpp'] = Field(..., description='Cost per Gross Rating Point')
    rate: float = Field(..., description='Fixed CPP rate (cost per rating point)', ge=0.0)
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    parameters: Parameters1 = Field(
        ..., description='CPP-specific parameters for demographic targeting and GRP requirements'
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class Parameters2(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    duration_hours: float | None = Field(
        None, description='Duration in hours for time-based flat rate pricing (DOOH)', ge=0.0
    )
    sov_percentage: float | None = Field(
        None, description='Guaranteed share of voice as percentage (DOOH, 0-100)', ge=0.0, le=100.0
    )
    loop_duration_seconds: int | None = Field(
        None, description='Duration of ad loop rotation in seconds (DOOH)', ge=1
    )
    min_plays_per_hour: int | None = Field(
        None,
        description='Minimum number of times ad plays per hour (DOOH frequency guarantee)',
        ge=0,
    )
    venue_package: str | None = Field(
        None,
        description="Named venue package identifier for DOOH (e.g., 'times_square_network', 'airport_terminals')",
    )
    estimated_impressions: int | None = Field(
        None,
        description='Estimated impressions for this flat rate option (informational, commonly used with SOV or time-based DOOH)',
        ge=0,
    )
    daypart: str | None = Field(
        None,
        description="Specific daypart for time-based pricing (e.g., 'morning_commute', 'evening_prime', 'overnight')",
    )


class FlatRateOption(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    pricing_option_id: str = Field(
        ...,
        description="Unique identifier for this pricing option within the product (e.g., 'flat_rate_usd_24h_takeover')",
    )
    pricing_model: Literal['flat_rate'] = Field(
        ..., description='Fixed cost regardless of delivery volume'
    )
    rate: float = Field(..., description='Flat rate cost', ge=0.0)
    currency: str = Field(
        ...,
        description='ISO 4217 currency code',
        examples=['USD', 'EUR', 'GBP', 'JPY'],
        pattern='^[A-Z]{3}$',
    )
    is_fixed: Literal[True] = Field(
        ..., description='Whether this is a fixed rate (true) or auction-based (false)'
    )
    parameters: Parameters2 | None = Field(
        None, description='Flat rate parameters for DOOH and time-based campaigns'
    )
    min_spend_per_package: float | None = Field(
        None,
        description='Minimum spend requirement per package using this pricing option, in the specified currency',
        ge=0.0,
    )


class Measurement(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    type: str = Field(
        ...,
        description='Type of measurement',
        examples=['incremental_sales_lift', 'brand_lift', 'foot_traffic'],
    )
    attribution: str = Field(
        ...,
        description='Attribution methodology',
        examples=['deterministic_purchase', 'probabilistic'],
    )
    window: str | None = Field(
        None, description='Attribution window', examples=['30_days', '7_days']
    )
    reporting: str = Field(
        ...,
        description='Reporting frequency and format',
        examples=['weekly_dashboard', 'real_time_api'],
    )


class AvailableReportingFrequency(Enum):
    hourly = 'hourly'
    daily = 'daily'
    monthly = 'monthly'


class AvailableMetric(Enum):
    impressions = 'impressions'
    spend = 'spend'
    clicks = 'clicks'
    ctr = 'ctr'
    video_completions = 'video_completions'
    completion_rate = 'completion_rate'
    conversions = 'conversions'
    viewability = 'viewability'
    engagement_rate = 'engagement_rate'


class ReportingCapabilities(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    available_reporting_frequencies: list[AvailableReportingFrequency] = Field(
        ..., description='Supported reporting frequency options', min_length=1
    )
    expected_delay_minutes: int = Field(
        ...,
        description='Expected delay in minutes before reporting data becomes available (e.g., 240 for 4-hour delay)',
        examples=[240, 300, 1440],
        ge=0,
    )
    timezone: str = Field(
        ...,
        description="Timezone for reporting periods. Use 'UTC' or IANA timezone (e.g., 'America/New_York'). Critical for daily/monthly frequency alignment.",
        examples=['UTC', 'America/New_York', 'Europe/London', 'America/Los_Angeles'],
    )
    supports_webhooks: bool = Field(
        ..., description='Whether this product supports webhook-based reporting notifications'
    )
    available_metrics: list[AvailableMetric] = Field(
        ...,
        description='Metrics available in reporting. Impressions and spend are always implicitly included.',
        examples=[
            ['impressions', 'spend', 'clicks', 'video_completions'],
            ['impressions', 'spend', 'conversions'],
        ],
    )


class CoBranding(Enum):
    required = 'required'
    optional = 'optional'
    none = 'none'


class LandingPage(Enum):
    any = 'any'
    retailer_site_only = 'retailer_site_only'
    must_include_retailer = 'must_include_retailer'


class CreativePolicy(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    co_branding: CoBranding = Field(..., description='Co-branding requirement')
    landing_page: LandingPage = Field(..., description='Landing page requirements')
    templates_available: bool = Field(..., description='Whether creative templates are provided')


class ProductCard(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    format_id: FormatId = Field(
        ...,
        description='Creative format defining the card layout (typically product_card_standard)',
    )
    manifest: dict[str, Any] = Field(
        ..., description='Asset manifest for rendering the card, structure defined by the format'
    )


class ProductCardDetailed(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    format_id: FormatId = Field(
        ...,
        description='Creative format defining the detailed card layout (typically product_card_detailed)',
    )
    manifest: dict[str, Any] = Field(
        ...,
        description='Asset manifest for rendering the detailed card, structure defined by the format',
    )


class PricingOption(
    RootModel[
        CpmFixedOption
        | CpmAuctionOption
        | VcpmFixedOption
        | VcpmAuctionOption
        | CpcOption
        | CpcvOption
        | CpvOption
        | CppOption
        | FlatRateOption
    ]
):
    root: (
        CpmFixedOption
        | CpmAuctionOption
        | VcpmFixedOption
        | VcpmAuctionOption
        | CpcOption
        | CpcvOption
        | CpvOption
        | CppOption
        | FlatRateOption
    ) = Field(
        ...,
        description='A pricing model option offered by a publisher for a product. Each pricing model has its own schema with model-specific requirements.',
        title='Pricing Option',
    )


class Product(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    product_id: str = Field(..., description='Unique identifier for the product')
    name: str = Field(..., description='Human-readable product name')
    description: str = Field(
        ..., description='Detailed description of the product and its inventory'
    )
    publisher_properties: list[PublisherProperty] = Field(
        ...,
        description="Publisher properties covered by this product. Buyers fetch actual property definitions from each publisher's adagents.json and validate agent authorization.",
        min_length=1,
    )
    format_ids: list[FormatId] = Field(
        ...,
        description='Array of supported creative format IDs - structured format_id objects with agent_url and id',
    )
    placements: list[Placement] | None = Field(
        None,
        description='Optional array of specific placements within this product. When provided, buyers can target specific placements when assigning creatives.',
        min_length=1,
    )
    delivery_type: DeliveryType
    pricing_options: list[PricingOption] = Field(
        ..., description='Available pricing models for this product', min_length=1
    )
    estimated_exposures: int | None = Field(
        None, description='Estimated exposures/impressions for guaranteed products', ge=0
    )
    measurement: Measurement | None = None
    delivery_measurement: DeliveryMeasurement = Field(
        ...,
        description='Measurement provider and methodology for delivery metrics. The buyer accepts the declared provider as the source of truth for the buy. REQUIRED for all products.',
    )
    reporting_capabilities: ReportingCapabilities | None = None
    creative_policy: CreativePolicy | None = None
    is_custom: bool | None = Field(None, description='Whether this is a custom product')
    brief_relevance: str | None = Field(
        None,
        description='Explanation of why this product matches the brief (only included when brief is provided)',
    )
    expires_at: AwareDatetime | None = Field(
        None, description='Expiration timestamp for custom products'
    )
    product_card: ProductCard | None = Field(
        None,
        description='Optional standard visual card (300x400px) for displaying this product in user interfaces. Can be rendered via preview_creative or pre-generated.',
    )
    product_card_detailed: ProductCardDetailed | None = Field(
        None,
        description='Optional detailed card with carousel and full specifications. Provides rich product presentation similar to media kit pages.',
    )
