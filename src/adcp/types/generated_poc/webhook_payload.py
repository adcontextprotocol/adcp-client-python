# generated by datamodel-codegen:
#   filename:  webhook-payload.json
#   timestamp: 2025-11-15T17:41:41+00:00

from __future__ import annotations

from enum import Enum
from typing import Any

from adcp.types.base import AdCPBaseModel
from pydantic import AwareDatetime, ConfigDict, Field


class Domain(Enum):
    media_buy = 'media-buy'
    signals = 'signals'


class Progress(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    percentage: float | None = Field(
        None, description='Completion percentage (0-100)', ge=0.0, le=100.0
    )
    current_step: str | None = Field(None, description='Current step or phase of the operation')
    total_steps: int | None = Field(
        None, description='Total number of steps in the operation', ge=1
    )
    step_number: int | None = Field(None, description='Current step number', ge=1)


class TaskType(Enum):
    create_media_buy = 'create_media_buy'
    update_media_buy = 'update_media_buy'
    sync_creatives = 'sync_creatives'
    activate_signal = 'activate_signal'
    get_signals = 'get_signals'


class TaskStatus(Enum):
    submitted = 'submitted'
    working = 'working'
    input_required = 'input-required'
    completed = 'completed'
    canceled = 'canceled'
    failed = 'failed'
    rejected = 'rejected'
    auth_required = 'auth-required'
    unknown = 'unknown'


class WebhookPayload(AdCPBaseModel):
    model_config = ConfigDict(
        extra='allow',
    )
    operation_id: str | None = Field(
        None,
        description='Publisher-defined operation identifier correlating a sequence of task updates across webhooks.',
    )
    task_id: str = Field(
        ...,
        description='Unique identifier for this task. Use this to correlate webhook notifications with the original task submission.',
    )
    task_type: TaskType = Field(
        ...,
        description='Type of AdCP operation that triggered this webhook. Enables webhook handlers to route to appropriate processing logic.',
    )
    domain: Domain | None = Field(
        None,
        description='AdCP domain this task belongs to. Helps classify the operation type at a high level.',
    )
    status: TaskStatus = Field(
        ...,
        description='Current task status. Webhooks are only triggered for status changes after initial submission (e.g., submitted → input-required, submitted → completed, submitted → failed).',
    )
    timestamp: AwareDatetime = Field(
        ..., description='ISO 8601 timestamp when this webhook was generated.'
    )
    message: str | None = Field(
        None,
        description='Human-readable summary of the current task state. Provides context about what happened and what action may be needed.',
    )
    context_id: str | None = Field(
        None,
        description='Session/conversation identifier. Use this to continue the conversation if input-required status needs clarification or additional parameters.',
    )
    progress: Progress | None = Field(
        None,
        description="Progress information for tasks still in 'working' state. Rarely seen in webhooks since 'working' tasks typically complete synchronously, but may appear if a task transitions from 'submitted' to 'working'.",
    )
    result: dict[str, Any] | None = Field(
        None,
        description='Task-specific payload for this status update. Validated against the appropriate response schema based on task_type.',
    )
    error: str | None = Field(
        None, description="Error message for failed tasks. Only present when status is 'failed'."
    )
