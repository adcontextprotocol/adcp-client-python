# generated by datamodel-codegen:
#   filename:  get-media-buy-delivery-response.json
#   timestamp: 2025-11-15T17:40:28+00:00

from __future__ import annotations

from enum import Enum
from typing import Any

from adcp.types.base import AdCPBaseModel
from pydantic import AwareDatetime, ConfigDict, Field


class NotificationType(Enum):
    scheduled = 'scheduled'
    final = 'final'
    delayed = 'delayed'
    adjusted = 'adjusted'


class ReportingPeriod(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    start: AwareDatetime = Field(
        ..., description='ISO 8601 start timestamp in UTC (e.g., 2024-02-05T00:00:00Z)'
    )
    end: AwareDatetime = Field(
        ..., description='ISO 8601 end timestamp in UTC (e.g., 2024-02-05T23:59:59Z)'
    )


class AggregatedTotals(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    impressions: float = Field(
        ..., description='Total impressions delivered across all media buys', ge=0.0
    )
    spend: float = Field(..., description='Total amount spent across all media buys', ge=0.0)
    clicks: float | None = Field(
        None, description='Total clicks across all media buys (if applicable)', ge=0.0
    )
    video_completions: float | None = Field(
        None, description='Total video completions across all media buys (if applicable)', ge=0.0
    )
    media_buy_count: int = Field(
        ..., description='Number of media buys included in the response', ge=0
    )


class Status(Enum):
    pending = 'pending'
    active = 'active'
    paused = 'paused'
    completed = 'completed'
    failed = 'failed'
    reporting_delayed = 'reporting_delayed'


class DailyBreakdownItem(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    date: str = Field(..., description='Date (YYYY-MM-DD)', pattern='^\\d{4}-\\d{2}-\\d{2}$')
    impressions: float = Field(..., description='Daily impressions', ge=0.0)
    spend: float = Field(..., description='Daily spend', ge=0.0)


class PricingModel(Enum):
    cpm = 'cpm'
    vcpm = 'vcpm'
    cpc = 'cpc'
    cpcv = 'cpcv'
    cpv = 'cpv'
    cpp = 'cpp'
    flat_rate = 'flat_rate'


class QuartileData(AdCPBaseModel):
    q1_views: float | None = Field(None, description='25% completion views', ge=0.0)
    q2_views: float | None = Field(None, description='50% completion views', ge=0.0)
    q3_views: float | None = Field(None, description='75% completion views', ge=0.0)
    q4_views: float | None = Field(None, description='100% completion views', ge=0.0)


class VenueBreakdownItem(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    venue_id: str = Field(..., description='Venue identifier')
    venue_name: str | None = Field(None, description='Human-readable venue name')
    venue_type: str | None = Field(
        None, description="Venue type (e.g., 'airport', 'transit', 'retail', 'billboard')"
    )
    impressions: int = Field(..., description='Impressions delivered at this venue', ge=0)
    loop_plays: int | None = Field(None, description='Loop plays at this venue', ge=0)
    screens_used: int | None = Field(None, description='Number of screens used at this venue', ge=0)


class DoohMetrics(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    loop_plays: int | None = Field(None, description='Number of times ad played in rotation', ge=0)
    screens_used: int | None = Field(
        None, description='Number of unique screens displaying the ad', ge=0
    )
    screen_time_seconds: int | None = Field(None, description='Total display time in seconds', ge=0)
    sov_achieved: float | None = Field(
        None, description='Actual share of voice delivered (0.0 to 1.0)', ge=0.0, le=1.0
    )
    calculation_notes: str | None = Field(
        None, description='Explanation of how DOOH impressions were calculated'
    )
    venue_breakdown: list[VenueBreakdownItem] | None = Field(
        None, description='Per-venue performance breakdown'
    )


class DeliveryMetrics(AdCPBaseModel):
    model_config = ConfigDict(
        extra='allow',
    )
    impressions: float | None = Field(None, description='Impressions delivered', ge=0.0)
    spend: float | None = Field(None, description='Amount spent', ge=0.0)
    clicks: float | None = Field(None, description='Total clicks', ge=0.0)
    ctr: float | None = Field(
        None, description='Click-through rate (clicks/impressions)', ge=0.0, le=1.0
    )
    views: float | None = Field(None, description='Views at threshold (for CPV)', ge=0.0)
    completed_views: float | None = Field(None, description='100% completions (for CPCV)', ge=0.0)
    completion_rate: float | None = Field(
        None, description='Completion rate (completed_views/impressions)', ge=0.0, le=1.0
    )
    conversions: float | None = Field(
        None, description='Conversions (reserved for future CPA pricing support)', ge=0.0
    )
    leads: float | None = Field(
        None, description='Leads generated (reserved for future CPL pricing support)', ge=0.0
    )
    grps: float | None = Field(None, description='Gross Rating Points delivered (for CPP)', ge=0.0)
    reach: float | None = Field(
        None,
        description='Unique reach - units depend on measurement provider (e.g., individuals, households, devices, cookies). See delivery_measurement.provider for methodology.',
        ge=0.0,
    )
    frequency: float | None = Field(
        None,
        description='Average frequency per individual (typically measured over campaign duration, but can vary by measurement provider)',
        ge=0.0,
    )
    quartile_data: QuartileData | None = Field(None, description='Video quartile completion data')
    dooh_metrics: DoohMetrics | None = Field(
        None, description='DOOH-specific metrics (only included for DOOH campaigns)'
    )


class Error(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    code: str = Field(..., description='Error code for programmatic handling')
    message: str = Field(..., description='Human-readable error message')
    field: str | None = Field(
        None, description="Field path associated with the error (e.g., 'packages[0].targeting')"
    )
    suggestion: str | None = Field(None, description='Suggested fix for the error')
    retry_after: float | None = Field(
        None, description='Seconds to wait before retrying the operation', ge=0.0
    )
    details: Any | None = Field(None, description='Additional task-specific error details')


class Totals(DeliveryMetrics):
    effective_rate: float | None = Field(
        None,
        description="Effective rate paid per unit based on pricing_model (e.g., actual CPM for 'cpm', actual cost per completed view for 'cpcv', actual cost per point for 'cpp')",
        ge=0.0,
    )


class ByPackageItem(DeliveryMetrics):
    package_id: str = Field(..., description="Publisher's package identifier")
    buyer_ref: str | None = Field(None, description="Buyer's reference identifier for this package")
    pacing_index: float | None = Field(
        None, description='Delivery pace (1.0 = on track, <1.0 = behind, >1.0 = ahead)', ge=0.0
    )
    pricing_model: PricingModel = Field(
        ...,
        description='The pricing model used for this package (e.g., cpm, cpcv, cpp). Indicates how the package is billed and which metrics are most relevant for optimization.',
    )
    rate: float = Field(
        ...,
        description='The pricing rate for this package in the specified currency. For fixed-rate pricing, this is the agreed rate (e.g., CPM rate of 12.50 means $12.50 per 1,000 impressions). For auction-based pricing, this represents the effective rate based on actual delivery.',
        ge=0.0,
    )
    currency: str = Field(
        ...,
        description="ISO 4217 currency code (e.g., USD, EUR, GBP) for this package's pricing. Indicates the currency in which the rate and spend values are denominated. Different packages can use different currencies when supported by the publisher.",
        pattern='^[A-Z]{3}$',
    )


class MediaBuyDelivery(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    media_buy_id: str = Field(..., description="Publisher's media buy identifier")
    buyer_ref: str | None = Field(
        None, description="Buyer's reference identifier for this media buy"
    )
    status: Status = Field(
        ...,
        description='Current media buy status. In webhook context, reporting_delayed indicates data temporarily unavailable.',
    )
    expected_availability: AwareDatetime | None = Field(
        None,
        description='When delayed data is expected to be available (only present when status is reporting_delayed)',
    )
    is_adjusted: bool | None = Field(
        None,
        description='Indicates this delivery contains updated data for a previously reported period. Buyer should replace previous period data with these totals.',
    )
    pricing_model: PricingModel | None = Field(
        None, description='Pricing model used for this media buy'
    )
    totals: Totals
    by_package: list[ByPackageItem] = Field(..., description='Metrics broken down by package')
    daily_breakdown: list[DailyBreakdownItem] | None = Field(
        None, description='Day-by-day delivery'
    )


class GetMediaBuyDeliveryResponse(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    notification_type: NotificationType | None = Field(
        None,
        description='Type of webhook notification (only present in webhook deliveries): scheduled = regular periodic update, final = campaign completed, delayed = data not yet available, adjusted = resending period with updated data',
    )
    partial_data: bool | None = Field(
        None,
        description='Indicates if any media buys in this webhook have missing/delayed data (only present in webhook deliveries)',
    )
    unavailable_count: int | None = Field(
        None,
        description='Number of media buys with reporting_delayed or failed status (only present in webhook deliveries when partial_data is true)',
        ge=0,
    )
    sequence_number: int | None = Field(
        None,
        description='Sequential notification number (only present in webhook deliveries, starts at 1)',
        ge=1,
    )
    next_expected_at: AwareDatetime | None = Field(
        None,
        description="ISO 8601 timestamp for next expected notification (only present in webhook deliveries when notification_type is not 'final')",
    )
    reporting_period: ReportingPeriod = Field(
        ..., description='Date range for the report. All periods use UTC timezone.'
    )
    currency: str = Field(..., description='ISO 4217 currency code', pattern='^[A-Z]{3}$')
    aggregated_totals: AggregatedTotals | None = Field(
        None,
        description='Combined metrics across all returned media buys. Only included in API responses (get_media_buy_delivery), not in webhook notifications.',
    )
    media_buy_deliveries: list[MediaBuyDelivery] = Field(
        ...,
        description='Array of delivery data for media buys. When used in webhook notifications, may contain multiple media buys aggregated by publisher. When used in get_media_buy_delivery API responses, typically contains requested media buys.',
    )
    errors: list[Error] | None = Field(
        None,
        description='Task-specific errors and warnings (e.g., missing delivery data, reporting platform issues)',
    )
    context: dict[str, Any] | None = Field(
        None,
        description='Initiator-provided context echoed inside the task payload. Opaque metadata such as UI/session hints, correlation tokens, or tracking identifiers.',
    )
