# generated by datamodel-codegen:
#   filename:  media-buy.json
#   timestamp: 2025-11-15T17:40:51+00:00

from __future__ import annotations

from enum import Enum

from adcp.types.base import AdCPBaseModel
from pydantic import AnyUrl, AwareDatetime, ConfigDict, Field, RootModel


class MediaBuyStatus(Enum):
    pending_activation = 'pending_activation'
    active = 'active'
    paused = 'paused'
    completed = 'completed'


class Pacing(Enum):
    even = 'even'
    asap = 'asap'
    front_loaded = 'front_loaded'


class GeoCountryAnyOfItem(RootModel[str]):
    root: str = Field(..., pattern='^[A-Z]{2}$')


class FrequencyCap(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    suppress_minutes: float = Field(..., description='Minutes to suppress after impression', ge=0.0)


class CreativeAssignment(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    creative_id: str = Field(..., description='Unique identifier for the creative')
    weight: float | None = Field(
        None, description='Delivery weight for this creative', ge=0.0, le=100.0
    )
    placement_ids: list[str] | None = Field(
        None,
        description="Optional array of placement IDs where this creative should run. When omitted, the creative runs on all placements in the package. References placement_id values from the product's placements array.",
        min_length=1,
    )


class FormatId(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    agent_url: AnyUrl = Field(
        ...,
        description="URL of the agent that defines this format (e.g., 'https://creatives.adcontextprotocol.org' for standard formats, or 'https://publisher.com/.well-known/adcp/sales' for custom formats)",
    )
    id: str = Field(
        ...,
        description="Format identifier within the agent's namespace (e.g., 'display_300x250', 'video_standard_30s')",
        pattern='^[a-zA-Z0-9_-]+$',
    )


class PackageStatus(Enum):
    draft = 'draft'
    active = 'active'
    paused = 'paused'
    completed = 'completed'


class Targeting(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    geo_country_any_of: list[GeoCountryAnyOfItem] | None = Field(
        None,
        description='Restrict delivery to specific countries (ISO codes). Use for regulatory compliance or RCT testing.',
    )
    geo_region_any_of: list[str] | None = Field(
        None,
        description='Restrict delivery to specific regions/states. Use for regulatory compliance or RCT testing.',
    )
    geo_metro_any_of: list[str] | None = Field(
        None,
        description='Restrict delivery to specific metro areas (DMA codes). Use for regulatory compliance or RCT testing.',
    )
    geo_postal_code_any_of: list[str] | None = Field(
        None,
        description='Restrict delivery to specific postal/ZIP codes. Use for regulatory compliance or RCT testing.',
    )
    axe_include_segment: str | None = Field(
        None, description='AXE segment ID to include for targeting'
    )
    axe_exclude_segment: str | None = Field(
        None, description='AXE segment ID to exclude from targeting'
    )
    frequency_cap: FrequencyCap | None = None


class Package(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    package_id: str = Field(..., description="Publisher's unique identifier for the package")
    buyer_ref: str | None = Field(None, description="Buyer's reference identifier for this package")
    product_id: str | None = Field(None, description='ID of the product this package is based on')
    budget: float | None = Field(
        None,
        description='Budget allocation for this package in the currency specified by the pricing option',
        ge=0.0,
    )
    pacing: Pacing | None = None
    pricing_option_id: str | None = Field(
        None,
        description="ID of the selected pricing option from the product's pricing_options array",
    )
    bid_price: float | None = Field(
        None,
        description='Bid price for auction-based CPM pricing (present if using cpm-auction-option)',
        ge=0.0,
    )
    impressions: float | None = Field(None, description='Impression goal for this package', ge=0.0)
    targeting_overlay: Targeting | None = None
    creative_assignments: list[CreativeAssignment] | None = Field(
        None, description='Creative assets assigned to this package'
    )
    format_ids_to_provide: list[FormatId] | None = Field(
        None, description='Format IDs that creative assets will be provided for this package'
    )
    status: PackageStatus


class MediaBuy(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    media_buy_id: str = Field(..., description="Publisher's unique identifier for the media buy")
    buyer_ref: str | None = Field(
        None, description="Buyer's reference identifier for this media buy"
    )
    status: MediaBuyStatus
    promoted_offering: str = Field(
        ..., description='Description of advertiser and what is being promoted'
    )
    total_budget: float = Field(..., description='Total budget amount', ge=0.0)
    packages: list[Package] = Field(..., description='Array of packages within this media buy')
    creative_deadline: AwareDatetime | None = Field(
        None, description='ISO 8601 timestamp for creative upload deadline'
    )
    created_at: AwareDatetime | None = Field(None, description='Creation timestamp')
    updated_at: AwareDatetime | None = Field(None, description='Last update timestamp')
