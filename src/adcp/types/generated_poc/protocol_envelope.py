# generated by datamodel-codegen:
#   filename:  protocol-envelope.json
#   timestamp: 2025-11-15T17:41:09+00:00

from __future__ import annotations

from enum import Enum
from typing import Any

from adcp.types.base import AdCPBaseModel
from pydantic import AnyUrl, AwareDatetime, ConfigDict, Field


class TaskStatus(Enum):
    submitted = 'submitted'
    working = 'working'
    input_required = 'input-required'
    completed = 'completed'
    canceled = 'canceled'
    failed = 'failed'
    rejected = 'rejected'
    auth_required = 'auth-required'
    unknown = 'unknown'


class Scheme(Enum):
    Bearer = 'Bearer'
    HMAC_SHA256 = 'HMAC-SHA256'


class Authentication(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    schemes: list[Scheme] = Field(
        ...,
        description="Array of authentication schemes. Supported: ['Bearer'] for simple token auth, ['HMAC-SHA256'] for signature verification (recommended for production)",
        max_length=1,
        min_length=1,
    )
    credentials: str = Field(
        ...,
        description='Credentials for authentication. For Bearer: token sent in Authorization header. For HMAC-SHA256: shared secret used to generate signature. Minimum 32 characters. Exchanged out-of-band during onboarding.',
        min_length=32,
    )


class PushNotificationConfig(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    url: AnyUrl = Field(..., description='Webhook endpoint URL for task status notifications')
    token: str | None = Field(
        None,
        description='Optional client-provided token for webhook validation. Echoed back in webhook payload to validate request authenticity.',
        min_length=16,
    )
    authentication: Authentication = Field(
        ..., description='Authentication configuration for webhook delivery (A2A-compatible)'
    )


class ProtocolEnvelope(AdCPBaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    context_id: str | None = Field(
        None,
        description='Session/conversation identifier for tracking related operations across multiple task invocations. Managed by the protocol layer to maintain conversational context.',
    )
    task_id: str | None = Field(
        None,
        description='Unique identifier for tracking asynchronous operations. Present when a task requires extended processing time. Used to query task status and retrieve results when complete.',
    )
    status: TaskStatus = Field(
        ...,
        description='Current task execution state. Indicates whether the task is completed, in progress (working), submitted for async processing, failed, or requires user input. Managed by the protocol layer.',
    )
    message: str | None = Field(
        None,
        description='Human-readable summary of the task result. Provides natural language explanation of what happened, suitable for display to end users or for AI agent comprehension. Generated by the protocol layer based on the task response.',
    )
    timestamp: AwareDatetime | None = Field(
        None,
        description='ISO 8601 timestamp when the response was generated. Useful for debugging, logging, cache validation, and tracking async operation progress.',
    )
    push_notification_config: PushNotificationConfig | None = Field(
        None,
        description='Push notification configuration for async task updates (A2A and REST protocols). Echoed from the request to confirm webhook settings. Specifies URL, authentication scheme (Bearer or HMAC-SHA256), and credentials. MCP uses progress notifications instead of webhooks.',
    )
    payload: dict[str, Any] = Field(
        ...,
        description='The actual task-specific response data. This is the content defined in individual task response schemas (e.g., get-products-response.json, create-media-buy-response.json). Contains only domain-specific data without protocol-level fields.',
    )
