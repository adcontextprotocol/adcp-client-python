{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "Response containing preview links for one or more creatives. Format matches the request: single preview response for single requests, batch results for batch requests.",
  "oneOf": [
    {
      "additionalProperties": false,
      "description": "Single preview response - each preview URL returns an HTML page that can be embedded in an iframe",
      "properties": {
        "context": {
          "$ref": "../core/context.json"
        },
        "expires_at": {
          "description": "ISO 8601 timestamp when preview links expire",
          "format": "date-time",
          "type": "string"
        },
        "ext": {
          "$ref": "../core/ext.json"
        },
        "interactive_url": {
          "description": "Optional URL to an interactive testing page that shows all preview variants with controls to switch between them, modify macro values, and test different scenarios.",
          "format": "uri",
          "type": "string"
        },
        "previews": {
          "description": "Array of preview variants. Each preview corresponds to an input set from the request. If no inputs were provided, returns a single default preview.",
          "items": {
            "properties": {
              "input": {
                "description": "The input parameters that generated this preview variant. Echoes back the request input or shows defaults used.",
                "properties": {
                  "context_description": {
                    "description": "Context description applied to this variant",
                    "type": "string"
                  },
                  "macros": {
                    "additionalProperties": {
                      "type": "string"
                    },
                    "description": "Macro values applied to this variant",
                    "type": "object"
                  },
                  "name": {
                    "description": "Human-readable name for this variant",
                    "type": "string"
                  }
                },
                "required": [
                  "name"
                ],
                "type": "object"
              },
              "preview_id": {
                "description": "Unique identifier for this preview variant",
                "type": "string"
              },
              "renders": {
                "description": "Array of rendered pieces for this preview variant. Most formats render as a single piece. Companion ad formats (video + banner), multi-placement formats, and adaptive formats render as multiple pieces.",
                "items": {
                  "$ref": "preview-render.json"
                },
                "minItems": 1,
                "type": "array"
              }
            },
            "required": [
              "preview_id",
              "renders",
              "input"
            ],
            "type": "object"
          },
          "minItems": 1,
          "type": "array"
        },
        "response_type": {
          "const": "single",
          "description": "Discriminator indicating this is a single preview response",
          "type": "string"
        }
      },
      "required": [
        "response_type",
        "previews",
        "expires_at"
      ],
      "type": "object"
    },
    {
      "additionalProperties": false,
      "description": "Batch preview response - contains results for multiple creative requests",
      "properties": {
        "context": {
          "$ref": "../core/context.json"
        },
        "ext": {
          "$ref": "../core/ext.json"
        },
        "response_type": {
          "const": "batch",
          "description": "Discriminator indicating this is a batch preview response",
          "type": "string"
        },
        "results": {
          "description": "Array of preview results corresponding to each request in the same order. results[0] is the result for requests[0], results[1] for requests[1], etc. Order is guaranteed even when some requests fail. Each result contains either a successful preview response or an error.",
          "items": {
            "oneOf": [
              {
                "properties": {
                  "success": {
                    "const": true,
                    "type": "boolean"
                  }
                },
                "required": [
                  "response"
                ]
              },
              {
                "properties": {
                  "success": {
                    "const": false,
                    "type": "boolean"
                  }
                },
                "required": [
                  "error"
                ]
              }
            ],
            "properties": {
              "error": {
                "description": "Error information for failed requests",
                "properties": {
                  "code": {
                    "description": "Error code (e.g., 'invalid_manifest', 'unsupported_format', 'missing_assets')",
                    "type": "string"
                  },
                  "details": {
                    "additionalProperties": true,
                    "description": "Additional error context",
                    "type": "object"
                  },
                  "message": {
                    "description": "Human-readable error message",
                    "type": "string"
                  }
                },
                "required": [
                  "code",
                  "message"
                ],
                "type": "object"
              },
              "response": {
                "description": "Preview response for successful requests",
                "properties": {
                  "expires_at": {
                    "format": "date-time",
                    "type": "string"
                  },
                  "interactive_url": {
                    "format": "uri",
                    "type": "string"
                  },
                  "previews": {
                    "description": "Array of preview variants for this creative",
                    "items": {
                      "properties": {
                        "input": {
                          "properties": {
                            "context_description": {
                              "type": "string"
                            },
                            "macros": {
                              "additionalProperties": {
                                "type": "string"
                              },
                              "type": "object"
                            },
                            "name": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "name"
                          ],
                          "type": "object"
                        },
                        "preview_id": {
                          "type": "string"
                        },
                        "renders": {
                          "items": {
                            "$ref": "preview-render.json"
                          },
                          "minItems": 1,
                          "type": "array"
                        }
                      },
                      "required": [
                        "preview_id",
                        "renders",
                        "input"
                      ],
                      "type": "object"
                    },
                    "minItems": 1,
                    "type": "array"
                  }
                },
                "required": [
                  "previews",
                  "expires_at"
                ],
                "type": "object"
              },
              "success": {
                "description": "Whether this preview request succeeded",
                "type": "boolean"
              }
            },
            "required": [
              "success"
            ],
            "type": "object"
          },
          "minItems": 1,
          "type": "array"
        }
      },
      "required": [
        "response_type",
        "results"
      ],
      "type": "object"
    }
  ],
  "title": "Preview Creative Response"
}